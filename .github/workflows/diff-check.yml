name: Check diff

on:
    pull_request:
        types: [opened, synchronize, reopened, ready_for_review]
    push:
        branches:
            - main

jobs:
  test:
    if: github.event.pull_request.draft == false
    
    name: Run tasks
    runs-on: ubuntu-latest
    steps:
        - name: Checkout
          uses: actions/checkout@v5
        - name: Setup Go
          uses: actions/setup-go@v6
        - name: Install Task
          uses: go-task/setup-task@v1
        - name: Set up Docker
          uses: docker/setup-docker-action@v4
        
        - name: go fmt
          run: |
            task fmt

        - name: Coverage
          run: |
            task coverage
            git diff --exit-code
        
        - name: Documentation (SDL)
          run : |
            task LIBRARY=sdl gen-doc
            git diff --exit-code ':!cmd/internal/assets/wiki/annotations.csv'
        - name: Documentation (TTF)
          run : |
            task LIBRARY=ttf gen-doc
            git diff --exit-code ':!cmd/internal/assets/wiki/annotations.csv'
        - name: Documentation (MIXER)
          run : |
            task LIBRARY=mixer gen-doc
            git diff --exit-code ':!cmd/internal/assets/wiki/annotations.csv'
        - name: Documentation (IMG)
          run : |
            task LIBRARY=img gen-doc
            git diff --exit-code ':!cmd/internal/assets/wiki/annotations.csv'